{"version":3,"file":"index.esm.js","sources":["../src/weak_promise.ts","../src/observable_value.ts","../src/distinct_value.ts","../src/async_action_runner.ts","../src/hooks/use_async_error_effect.ts","../src/hooks/use_update.ts","../src/hooks/use_async_error.ts","../src/hooks/use_async_value.ts","../src/hooks/use_async_status.ts","../src/hooks/use_async_state.ts","../src/hooks/use_async_value_effect.ts","../src/hooks/use_async_status_effect.ts"],"sourcesContent":["function noop() {}\n\nexport class WeakPromise<T> extends Promise<T> {\n  private _onCancel: (reason: any) => void;\n  private _reject: (reason: any) => void;\n\n  constructor(callback: (resolve: any, reject: any) => () => void) {\n    let onCancel = noop;\n    let _reject = noop;\n    let clean = noop;\n\n    super((resolve, reject) => {\n      _reject = reject;\n      onCancel = callback((value: T) => {\n        clean();\n        resolve(value);\n      }, reject);\n    });\n\n    clean = () => {\n      this._onCancel = noop;\n      this._reject = noop;\n    };\n    this._onCancel = onCancel;\n    this._reject = _reject;\n  }\n\n  cancel(reason: any) {\n    this._onCancel(reason);\n    this._reject(reason);\n  }\n\n  static resolve(): WeakPromise<void>;\n  static resolve<T>(value: T | PromiseLike<T>): WeakPromise<T>;\n  static resolve<T>(value?: unknown): WeakPromise<void> | WeakPromise<T> {\n    const isPromiseLike = value && typeof (value as any).then === \"function\";\n\n    if (isPromiseLike) {\n      return new WeakPromise<T>((resolve, reject) => {\n        (value as any).then(resolve, reject);\n        return () => {};\n      });\n    }\n\n    return new WeakPromise<T>((resolve) => {\n      resolve(value);\n      return noop;\n    });\n  }\n\n  static reject<T = never>(reason?: any): WeakPromise<T> {\n    return new WeakPromise((_resolve, reject) => {\n      reject(reason);\n      return noop;\n    });\n  }\n\n  static from<T>(promise: Promise<T>) {\n    if (promise instanceof WeakPromise) {\n      return promise;\n    }\n    return new WeakPromise((resolve, reject) => {\n      promise.then(resolve).catch(reject);\n      return noop;\n    });\n  }\n}\n","export type Subscription = () => void;\n\nexport class ObservableValue<T, TError = any>\n  implements ReadonlyObservableValue<T, TError>\n{\n  protected key: string | undefined;\n  protected _valueVersion = 0;\n  protected _errorVersion = 0;\n  protected _value: T;\n  protected _error: TError | null = null;\n\n  readonly valueCallbacks: ((value: T) => void)[] = [];\n  readonly errorCallbacks: ((error: TError | null) => void)[] = [];\n\n  get valueVersion() {\n    return this._valueVersion;\n  }\n\n  get errorVersion() {\n    return this._errorVersion;\n  }\n\n  constructor(initialState: T) {\n    this._value = initialState;\n  }\n\n  getValue() {\n    return this._value;\n  }\n\n  setValue(value: T) {\n    try {\n      this._value = value;\n      this._valueVersion++;\n      this.notify(value);\n    } catch (e) {\n      this.setError(e as any);\n    }\n  }\n\n  transformValue(cb: (val: T) => T) {\n    const value = cb(this._value);\n    this.setValue(value);\n  }\n\n  onChange(callback: (value: T) => void) {\n    const unsubscribe = () => {\n      const index = this.valueCallbacks.indexOf(callback);\n      if (index > -1) {\n        this.valueCallbacks.splice(index, 1);\n      }\n    };\n\n    this.valueCallbacks.push(callback);\n    return unsubscribe;\n  }\n\n  setError(e: TError | null) {\n    try {\n      this._error = e;\n      this._errorVersion++;\n      this.notifyError(e);\n    } catch (e) {}\n  }\n\n  getError() {\n    return this._error;\n  }\n\n  onError(callback: (e: TError | null) => void) {\n    const unsubscribe = () => {\n      const index = this.errorCallbacks.indexOf(callback);\n      if (index > -1) {\n        this.errorCallbacks.splice(index, 1);\n      }\n    };\n\n    this.errorCallbacks.push(callback);\n    return unsubscribe;\n  }\n\n  dispose() {\n    this.disposeCallbacks();\n  }\n\n  private notify(value: T) {\n    this.valueCallbacks.forEach((c) => c(value));\n  }\n\n  private notifyError(error: TError | null) {\n    this.errorCallbacks.forEach((c) => c(error));\n  }\n\n  private disposeCallbacks() {\n    this.valueCallbacks.length = 0;\n    this.errorCallbacks.length = 0;\n  }\n}\n\nexport interface ReadonlyObservableValue<T, TError = any> {\n  valueVersion: number;\n  errorVersion: number;\n  getValue(): T;\n  getError(): TError | null;\n  onError(callback: (e: TError | null) => void): Subscription;\n  onChange(callback: (value: T) => void): Subscription;\n}\n\nexport default ObservableValue;\n","import { ObservableValue } from \"./observable_value\";\n\nconst defaultCompareFunction = (o: unknown, n: unknown) => o === n;\n\nexport class DistinctValue<T, TError = unknown> extends ObservableValue<\n  T,\n  TError\n> {\n  private compareFunction: (oldValue: T, newValue: T) => boolean;\n\n  constructor(\n    initialValue: T,\n    equalityOperator: (\n      oldValue: T,\n      newValue: T\n    ) => boolean = defaultCompareFunction\n  ) {\n    super(initialValue);\n    this.compareFunction = equalityOperator;\n  }\n\n  setValue(value: T) {\n    if (!this.compareFunction(this._value, value)) {\n      super.setValue(value);\n      return true;\n    }\n    return false;\n  }\n}\n","import ObservableValue, { ReadonlyObservableValue } from \"./observable_value\";\nimport { WeakPromise } from \"./weak_promise\";\n\nexport enum Status {\n  INITIAL = \"initial\",\n  PENDING = \"pending\",\n  ERROR = \"error\",\n  SUCCESS = \"success\",\n}\n\nexport type Action<T> = () => WeakPromise<T> | Promise<T>;\n\nexport interface ReadonlyAsyncActionRunner<T, TError = any>\n  extends ReadonlyObservableValue<T, TError> {\n  readonly status: ReadonlyObservableValue<Status>;\n  execute(action: Action<T>): Promise<T>;\n  retry(): Promise<T>;\n  cancel(): void;\n  reset(): void;\n}\n\nexport class CancelledError extends Error {\n  constructor(message?: string) {\n    super(message);\n    this.name = \"CancelledError\";\n  }\n}\n\ninterface Context<T> {\n  action: Action<T>;\n  activePromise: WeakPromise<T>;\n  changeState(state: State<T>): void;\n  setValue(value: T): void;\n  setError(error: unknown): void;\n}\n\nexport class AsyncActionRunner<T, TError = any>\n  extends ObservableValue<T, TError>\n  implements ReadonlyAsyncActionRunner<T, TError>\n{\n  private _internalState: State<T>;\n  private _action!: () => WeakPromise<T>;\n  private _activePromise!: WeakPromise<T>;\n  private _initialValue: T;\n  readonly status: ObservableValue<Status>;\n\n  constructor(initialValue: T) {\n    super(initialValue);\n\n    this.setValue = this.setValue.bind(this);\n    this.setError = this.setError.bind(this);\n\n    this._internalState = new InitialState<T>({\n      action: this._action,\n      activePromise: this._activePromise,\n      changeState: this.changeState,\n      setValue: this.setValue,\n      setError: this.setError,\n    });\n\n    this._initialValue = initialValue;\n    this.status = new ObservableValue<Status>(Status.INITIAL);\n  }\n\n  private changeState = (state: State<T>) => {\n    this._internalState = state;\n    this.status.setValue(state.getName());\n  };\n\n  execute(action: Action<T>) {\n    return this._internalState.execute(action);\n  }\n\n  cancel() {\n    this.reset();\n  }\n\n  retry() {\n    return this._internalState.retry();\n  }\n\n  reset() {\n    this._internalState.cancel();\n    this.setError(null);\n    this.setValue(this._initialValue);\n    this.changeState(\n      new InitialState<T>({\n        action: this._action,\n        activePromise: this._activePromise,\n        changeState: this.changeState,\n        setValue: this.setValue,\n        setError: this.setError,\n      })\n    );\n  }\n\n  dispose() {\n    super.dispose();\n    this.status.dispose();\n  }\n}\n\nabstract class State<T> {\n  protected context: Context<T>;\n  protected key: string | undefined;\n\n  constructor(context: Context<T>, key?: string) {\n    this.key = key;\n    this.context = context;\n  }\n\n  abstract getName(): Status;\n\n  execute(_action: Action<T>): Promise<T> {\n    return Promise.reject(new Error(\"Not Yet Implemented\"));\n  }\n\n  retry(): Promise<T> {\n    return Promise.reject(new Error(\"Not Yet Implemented\"));\n  }\n\n  cancel() {}\n}\n\nexport class InitialState<T> extends State<T> {\n  getName() {\n    return Status.INITIAL;\n  }\n\n  async execute(action: Action<T>) {\n    this.context.action = action;\n\n    try {\n      this.context.activePromise = WeakPromise.from(action());\n      const pendingState = new PendingState<T>(this.context);\n      this.context.changeState(pendingState);\n    } catch (error) {\n      this.context.setError(error as any);\n      this.context.changeState(new ErrorState<T>(this.context));\n      throw error;\n    }\n\n    try {\n      const value = await this.context.activePromise;\n      this.context.setValue(value);\n      this.context.changeState(new SuccessState<T>(this.context));\n      return value;\n    } catch (error) {\n      this.context.setError(error as any);\n      this.context.changeState(new ErrorState<T>(this.context));\n      throw error;\n    }\n  }\n\n  retry(): Promise<T> {\n    return Promise.reject(\n      new Error(\"Invalid Action: Cannot retry a runner that hasn't run.\")\n    );\n  }\n}\n\nexport class PendingState<T> extends State<T> {\n  constructor(context: Context<T>) {\n    super(context);\n  }\n\n  cancel() {\n    if (this.context.activePromise instanceof WeakPromise) {\n      this.context.activePromise.cancel(new CancelledError());\n    }\n  }\n\n  async execute(_action: Action<T>): Promise<T> {\n    throw new Error(\n      \"Invalid Action: Cannot execute on a pending async action.\"\n    );\n  }\n\n  retry(): Promise<T> {\n    return Promise.reject(\n      new Error(\"Invalid Action: Cannot retry a runner that is pending.\")\n    );\n  }\n\n  getName() {\n    return Status.PENDING;\n  }\n}\n\nexport class SuccessState<T> extends InitialState<T> {\n  getName() {\n    return Status.SUCCESS;\n  }\n\n  retry(): Promise<T> {\n    return Promise.reject(\n      new Error(\"Invalid Action: Cannot retry a runner that is successful.\")\n    );\n  }\n}\n\nexport class ErrorState<T> extends InitialState<T> {\n  retry() {\n    const initialState = new InitialState(this.context);\n    this.context.changeState(initialState);\n    return initialState.execute(this.context.action);\n  }\n\n  getName() {\n    return Status.ERROR;\n  }\n}\n","import { useEffect, useRef } from \"react\";\nimport { ReadonlyObservableValue } from \"../observable_value\";\n\nexport function useAsyncErrorEffect<TError>(\n  callback: (error: TError | null) => void,\n  observableValue: ReadonlyObservableValue<any, TError>\n) {\n  const callbackRef = useRef(callback);\n  const versionRef = useRef(observableValue.errorVersion);\n\n  useEffect(() => {\n    callbackRef.current = callback;\n  }, [callback]);\n\n  useEffect(() => {\n    const unsubscribe = observableValue.onError((error) => {\n      callbackRef.current(error);\n    });\n\n    if (versionRef.current !== observableValue.errorVersion) {\n      callbackRef.current(observableValue.getError());\n    }\n\n    return () => {\n      unsubscribe();\n    };\n  }, [observableValue]);\n\n  useEffect(() => {\n    callbackRef.current(observableValue.getError());\n  }, [observableValue]);\n}\n","import { useReducer } from 'react';\n\nconst updateReducer = (num: number): number => (num + 1) % 1_000_000;\n\nexport const useUpdate = () => {\n  const [, update] = useReducer(updateReducer, 0);\n  return update as () => void;\n};\n","import { useLayoutEffect, useRef } from 'react';\nimport { ReadonlyObservableValue } from '../observable_value';\nimport { useUpdate } from './use_update';\n\nexport function useAsyncError<TError>(\n  observableValue: ReadonlyObservableValue<any, TError>\n) {\n  const update = useUpdate();\n  const versionRef = useRef(observableValue.errorVersion);\n\n  useLayoutEffect(() => {\n    const subscription = observableValue.onError(update);\n    if (versionRef.current !== observableValue.valueVersion) {\n      update();\n    }\n    return () => subscription();\n  }, [observableValue, update]);\n\n  return observableValue.getError();\n}\n\nexport function useAsyncErrorMessage<TError extends { message?: string }>(\n  observableValue: ReadonlyObservableValue<any, TError>\n) {\n  const error = useAsyncError(observableValue);\n  return error?.message || '';\n}\n","import { useLayoutEffect, useRef } from \"react\";\nimport { ReadonlyObservableValue } from \"../observable_value\";\nimport { useUpdate } from \"./use_update\";\n\nexport function useAsyncValue<TValue, TInitial = TValue>(\n  observableValue: ReadonlyObservableValue<TValue, TInitial>\n) {\n  const update = useUpdate();\n  const versionRef = useRef(observableValue.valueVersion);\n\n  useLayoutEffect(() => {\n    const unsubscribe = observableValue.onChange(update);\n    if (versionRef.current !== observableValue.valueVersion) {\n      update();\n    }\n    return () => unsubscribe();\n  }, [observableValue, update]);\n\n  return observableValue.getValue();\n}\n","import { useState } from \"react\";\nimport { useAsyncValue } from \"./use_async_value\";\nimport { ReadonlyAsyncActionRunner, Status } from \"../async_action_runner\";\nimport { ReadonlyObservableValue } from \"../observable_value\";\n\nexport interface StatusHelper {\n  status: Status;\n  isInitial: boolean;\n  isPending: boolean;\n  isSuccess: boolean;\n  isError: boolean;\n}\n\nexport function useAsyncStatus(\n  runner:\n    | ReadonlyAsyncActionRunner<any>\n    | ReadonlyObservableValue<Status, any>\n) {\n  const status = useAsyncValue(\"status\" in runner ? runner.status : runner);\n\n  // We use the same object to reduce memory churn.\n  const [statusObject] = useState<StatusHelper>(() => ({\n    status: status,\n    isInitial: status === Status.INITIAL,\n    isPending: status === Status.PENDING,\n    isSuccess: status === Status.SUCCESS,\n    isError: status === Status.ERROR,\n  }));\n\n  statusObject.status = status;\n  statusObject.isInitial = status === Status.INITIAL;\n  statusObject.isPending = status === Status.PENDING;\n  statusObject.isSuccess = status === Status.SUCCESS;\n  statusObject.isError = status === Status.ERROR;\n\n  return statusObject;\n}\n","import { ReadonlyAsyncActionRunner } from \"../async_action_runner\";\nimport { useAsyncValue } from \"./use_async_value\";\nimport { useAsyncError } from \"./use_async_error\";\nimport { useAsyncStatus } from \"./use_async_status\";\n\nexport function useAsyncState<TValue, TError>(\n  asyncActionRunner: ReadonlyAsyncActionRunner<TValue, TError>\n) {\n  const value = useAsyncValue<TValue, TError>(asyncActionRunner);\n  const error = useAsyncError<TError>(asyncActionRunner);\n  const status = useAsyncStatus(asyncActionRunner);\n\n  return {\n    value,\n    error,\n    ...status,\n  };\n}\n","import { useLayoutEffect, useRef } from \"react\";\nimport { ReadonlyObservableValue } from \"../observable_value\";\n\nexport function useAsyncValueEffect<T>(\n  callback: (value: T) => void,\n  observableValue: ReadonlyObservableValue<T>\n) {\n  const callbackRef = useRef(callback);\n  const version = useRef(observableValue.valueVersion);\n\n  useLayoutEffect(() => {\n    callbackRef.current = callback;\n  }, [callback]);\n\n  useLayoutEffect(() => {\n    const unsubscribe = observableValue.onChange((value) => {\n      callbackRef.current(value);\n    });\n\n    if (version.current !== observableValue.valueVersion) {\n      callbackRef.current(observableValue.getValue());\n    }\n\n    return () => {\n      unsubscribe();\n    };\n  }, [observableValue]);\n\n  useLayoutEffect(() => {\n    callbackRef.current(observableValue.getValue());\n  }, [observableValue]);\n}\n","import { useRef, useState } from 'react';\nimport {\n  ReadonlyAsyncActionRunner,\n  Status,\n} from '../async_action_runner';\nimport { StatusHelper } from './use_async_status';\nimport { useAsyncValueEffect } from './use_async_value_effect';\n\nexport function useAsyncStatusEffect(\n  callback: (value: StatusHelper) => void,\n  runner: ReadonlyAsyncActionRunner<any>\n) {\n  const callbackRef = useRef(callback);\n\n  // We use the same object to reduce memory churn.\n  const [statusObject] = useState<StatusHelper>(() => {\n    return {\n      status: Status.INITIAL,\n      isInitial: true,\n      isPending: false,\n      isSuccess: false,\n      isError: false,\n    };\n  });\n\n  return useAsyncValueEffect(status => {\n    statusObject.status = status;\n    statusObject.isInitial = status === Status.INITIAL;\n    statusObject.isPending = status === Status.PENDING;\n    statusObject.isSuccess = status === Status.SUCCESS;\n    statusObject.isError = status === Status.ERROR;\n\n    callbackRef.current(statusObject);\n  }, runner.status);\n}\n"],"names":[],"mappings":"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"}